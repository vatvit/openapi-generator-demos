{{>licenseInfo}}
<?php

declare(strict_types=1);

namespace {{apiPackage}}\Http\Resources;

use Illuminate\Http\Resources\Json\JsonResource;
use {{modelPackage}}\{{baseType}};

/**
 * {{classname}}Resource
 *
 * Auto-generated Laravel Resource for {{operationId}} operation (HTTP {{code}})
 *
 * OpenAPI Operation: {{operationId}}
 * Response: {{code}} {{message}}
 * Schema: {{baseType}}
{{#headers}}
 * Header: {{baseName}} {{#required}}(REQUIRED){{/required}}{{^required}}(optional){{/required}}
{{/headers}}
 */
class {{classname}}Resource extends JsonResource
{
    /**
     * HTTP status code - Hardcoded: {{code}}
     */
    protected int $httpCode = {{code}};

{{#headers}}
    /**
     * {{baseName}} header {{#required}}(REQUIRED){{/required}}
     */
    public ?string ${{nameInCamelCase}} = null;

{{/headers}}
    /**
     * Transform the resource into an array.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return array<string, mixed>
     */
    public function toArray($request): array
    {
        /** @var {{baseType}} $model */
        $model = $this->resource;

        return [
{{#vars}}
            '{{baseName}}' => $model->{{name}},
{{/vars}}
        ];
    }

    /**
     * Customize the outgoing response.
     *
     * Enforces HTTP {{code}} status code{{#headers}} and headers{{/headers}}
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Illuminate\Http\Response  $response
     * @return void
     */
    public function withResponse($request, $response)
    {
        // Set hardcoded HTTP {{code}} status
        $response->setStatusCode($this->httpCode);

{{#headers}}
{{#required}}
        // {{baseName}} header is REQUIRED
        if ($this->{{nameInCamelCase}} === null) {
            throw new \RuntimeException(
                '{{baseName}} header is REQUIRED for {{operationId}} (HTTP {{code}}) but was not set'
            );
        }
{{/required}}
{{^required}}
        // {{baseName}} header is optional
        if ($this->{{nameInCamelCase}} !== null) {
{{/required}}
            $response->header('{{baseName}}', $this->{{nameInCamelCase}});
{{^required}}
        }
{{/required}}
{{/headers}}
    }
}
